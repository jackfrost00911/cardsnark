---
---
<!DOCTYPE html>
<html lang="en">
<head>
    {% include google-analytics.html %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Credit Simulator | CardSnark</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f8fafc; color: #0f172a; }
        
        /* Custom Form Elements */
        .input-group { position: relative; margin-bottom: 1.5rem; }
        .input-group label { display: block; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: #64748b; margin-bottom: 0.5rem; letter-spacing: 0.05em; }
        .pro-input { 
            width: 100%; padding: 0.75rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; 
            background: #fff; font-weight: 600; color: #1e293b; transition: all 0.2s;
        }
        .pro-input:focus { border-color: #4f46e5; outline: none; ring: 2px solid #e0e7ff; }

        /* Action Cards */
        .action-card { cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .action-radio:checked + .action-card { border-color: #4f46e5; background: #eef2ff; }
        .action-radio:checked + .action-card .icon-box { background: #4f46e5; color: white; }

        /* Gauge Container */
        .gauge-container { position: relative; width: 300px; height: 150px; margin: 0 auto; overflow: hidden; }
        .gauge-bg { position: absolute; top: 0; left: 0; width: 300px; height: 300px; border-radius: 50%; background: #e2e8f0; clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%); }
        .gauge-fill { 
            position: absolute; top: 0; left: 0; width: 300px; height: 300px; border-radius: 50%; 
            background: conic-gradient(from 180deg, #ef4444 0deg, #eab308 90deg, #22c55e 180deg); 
            clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%); 
            transform: rotate(0deg); transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        .gauge-center { 
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 260px; height: 130px; 
            background: white; border-top-left-radius: 150px; border-top-right-radius: 150px; 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 10px;
        }

        /* Layout Utilities */
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        #header-container, #footer-container { font-family: initial; }
    </style>
</head>
<body class="bg-slate-50">

    <div id="header-container"></div>
    <script>fetch('/includes/header.html').then(r => r.text()).then(d => document.getElementById('header-container').innerHTML = d);</script>

    <div class="bg-white border-b border-gray-200 pt-12 pb-8">
        <div class="max-w-6xl mx-auto px-4">
            <h1 class="text-3xl md:text-4xl font-black text-slate-900 mb-2">Credit Simulator <span class="text-indigo-600">Pro</span></h1>
            <p class="text-slate-500 max-w-2xl">Professional-grade modeling. Adjust your utilization, simulate inquiries, and visualize the impact before you act.</p>
        </div>
    </div>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <div class="lg:col-span-4 space-y-6">
                
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-slate-900 mb-4 border-b border-gray-100 pb-2">1. Current Baseline</h3>
                    
                    <div class="input-group">
                        <label>Current Credit Score</label>
                        <div class="flex items-center gap-3">
                            <input type="range" id="base-score-slider" min="300" max="850" value="700" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <input type="number" id="base-score-input" value="700" class="w-20 p-2 border border-gray-300 rounded-lg font-bold text-center" min="300" max="850">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="input-group">
                            <label>Total Credit Limit</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">$</span>
                                <input type="number" id="total-limit" value="10000" class="pro-input pl-7">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Current Balance</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">$</span>
                                <input type="number" id="total-balance" value="2500" class="pro-input pl-7">
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-50 rounded-lg p-3 flex justify-between items-center text-sm">
                        <span class="font-semibold text-slate-500">Current Utilization:</span>
                        <span id="current-util-display" class="font-black text-indigo-600">25%</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-slate-900 mb-4 border-b border-gray-100 pb-2">2. Select an Action</h3>
                    
                    <div class="space-y-3">
                        <label class="block cursor-pointer">
                            <input type="radio" name="action" value="pay" class="action-radio hidden" checked onchange="toggleInputs('pay')">
                            <div class="action-card p-3 rounded-xl bg-slate-50 hover:bg-white flex items-center gap-3">
                                <div class="icon-box w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-indigo-600"><i class="fa-solid fa-arrow-down"></i></div>
                                <div>
                                    <div class="font-bold text-sm text-slate-900">Pay Down Balance</div>
                                    <div class="text-xs text-slate-500">Reduce debt load</div>
                                </div>
                            </div>
                        </label>

                        <label class="block cursor-pointer">
                            <input type="radio" name="action" value="new_card" class="action-radio hidden" onchange="toggleInputs('new_card')">
                            <div class="action-card p-3 rounded-xl bg-slate-50 hover:bg-white flex items-center gap-3">
                                <div class="icon-box w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-indigo-600"><i class="fa-solid fa-plus"></i></div>
                                <div>
                                    <div class="font-bold text-sm text-slate-900">Open New Card</div>
                                    <div class="text-xs text-slate-500">Adds limit + Inquiry</div>
                                </div>
                            </div>
                        </label>

                        <label class="block cursor-pointer">
                            <input type="radio" name="action" value="late" class="action-radio hidden" onchange="toggleInputs('late')">
                            <div class="action-card p-3 rounded-xl bg-slate-50 hover:bg-white flex items-center gap-3">
                                <div class="icon-box w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-indigo-600"><i class="fa-solid fa-triangle-exclamation"></i></div>
                                <div>
                                    <div class="font-bold text-sm text-slate-900">Miss a Payment</div>
                                    <div class="text-xs text-slate-500">Simulate negative marks</div>
                                </div>
                            </div>
                        </label>

                        <label class="block cursor-pointer">
                            <input type="radio" name="action" value="spend" class="action-radio hidden" onchange="toggleInputs('spend')">
                            <div class="action-card p-3 rounded-xl bg-slate-50 hover:bg-white flex items-center gap-3">
                                <div class="icon-box w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-indigo-600"><i class="fa-solid fa-cart-shopping"></i></div>
                                <div>
                                    <div class="font-bold text-sm text-slate-900">Big Spending Spree</div>
                                    <div class="text-xs text-slate-500">Increase balance</div>
                                </div>
                            </div>
                        </label>
                    </div>

                    <div id="dynamic-inputs" class="mt-6 pt-6 border-t border-gray-100 slide-up">
                        <div class="input-group">
                            <label>Amount to Pay Off</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">$</span>
                                <input type="number" id="action-amount" value="1000" class="pro-input pl-7">
                            </div>
                        </div>
                    </div>

                    <button onclick="calculateSimulation()" class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 transition-all transform active:scale-95">
                        Simulate Outcome
                    </button>

                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                
                <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 relative overflow-hidden min-h-[500px] flex flex-col justify-center">
                    
                    <div class="text-center mb-8 relative z-10">
                        <div class="gauge-container mb-4">
                            <div class="gauge-bg"></div>
                            <div class="gauge-fill" id="gauge-fill"></div> <div class="gauge-center">
                                <div class="text-6xl font-black text-slate-900 tracking-tighter" id="result-score">700</div>
                                <div class="text-sm font-bold uppercase text-gray-400 mt-1 mb-2" id="result-rating">Good</div>
                            </div>
                        </div>
                        
                        <div id="points-badge" class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-500 rounded-full font-bold text-sm transition-all">
                            <i class="fa-solid fa-minus"></i> No Change
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 relative z-10">
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 text-center">
                            <div class="text-xs text-slate-500 font-bold uppercase mb-1">New Utilization</div>
                            <div class="text-2xl font-black text-slate-900" id="res-util">25%</div>
                            <div class="text-xs text-gray-400 mt-1">Ideal is &lt;10%</div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 text-center">
                            <div class="text-xs text-slate-500 font-bold uppercase mb-1">Payment History</div>
                            <div class="text-2xl font-black text-green-600" id="res-history">100%</div>
                            <div class="text-xs text-gray-400 mt-1">No recent lates</div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 text-center">
                            <div class="text-xs text-slate-500 font-bold uppercase mb-1">Credit Mix</div>
                            <div class="text-2xl font-black text-slate-900" id="res-inquiries">Stable</div>
                            <div class="text-xs text-gray-400 mt-1">Based on simulation</div>
                        </div>
                    </div>

                    <div class="mt-8 p-6 bg-indigo-50 rounded-xl border border-indigo-100">
                        <h4 class="font-bold text-indigo-900 mb-2 flex items-center">
                            <i class="fa-solid fa-robot mr-2"></i> CardSnark Analysis
                        </h4>
                        <p class="text-indigo-800 leading-relaxed" id="res-analysis">
                            Enter your details and select an action to see how the banks will judge you.
                        </p>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <div id="footer-container"></div>
    <script>fetch('/includes/footer.html').then(r => r.text()).then(d => document.getElementById('footer-container').innerHTML = d);</script>

    <script>
        // --- SYNC SLIDER & INPUT ---
        const baseSlider = document.getElementById('base-score-slider');
        const baseInput = document.getElementById('base-score-input');

        baseSlider.addEventListener('input', (e) => {
            baseInput.value = e.target.value;
            updateBaselineUtil();
        });
        baseInput.addEventListener('input', (e) => {
            baseSlider.value = e.target.value;
            updateBaselineUtil();
        });

        // --- UTILIZATION TRACKING ---
        const limitInput = document.getElementById('total-limit');
        const balInput = document.getElementById('total-balance');
        const utilDisplay = document.getElementById('current-util-display');

        function updateBaselineUtil() {
            const l = parseInt(limitInput.value) || 1;
            const b = parseInt(balInput.value) || 0;
            const u = Math.round((b / l) * 100);
            utilDisplay.innerText = u + "%";
            
            // Color coding
            if(u < 10) utilDisplay.className = "font-black text-green-600";
            else if(u < 30) utilDisplay.className = "font-black text-indigo-600";
            else if(u < 50) utilDisplay.className = "font-black text-yellow-600";
            else utilDisplay.className = "font-black text-red-600";
        }

        [limitInput, balInput].forEach(i => i.addEventListener('input', updateBaselineUtil));

        // --- DYNAMIC INPUT TOGGLING ---
        const inputArea = document.getElementById('dynamic-inputs');

        function toggleInputs(action) {
            let html = '';
            if(action === 'pay') {
                html = `
                    <div class="input-group slide-up">
                        <label>Amount to Pay Off</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-gray-400">$</span>
                            <input type="number" id="action-amount" value="1000" class="pro-input pl-7">
                        </div>
                    </div>`;
            } else if (action === 'spend') {
                html = `
                    <div class="input-group slide-up">
                        <label>Amount to Charge</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-gray-400">$</span>
                            <input type="number" id="action-amount" value="1000" class="pro-input pl-7">
                        </div>
                    </div>`;
            } else if (action === 'new_card') {
                html = `
                    <div class="input-group slide-up">
                        <label>New Credit Limit</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-gray-400">$</span>
                            <input type="number" id="action-amount" value="5000" class="pro-input pl-7">
                        </div>
                    </div>`;
            } else if (action === 'late') {
                html = `
                    <div class="input-group slide-up">
                        <label>How Late?</label>
                        <select id="action-late-type" class="pro-input">
                            <option value="30">30 Days</option>
                            <option value="60">60 Days</option>
                            <option value="90">90+ Days (Default)</option>
                        </select>
                    </div>`;
            }
            inputArea.innerHTML = html;
        }

        // --- MAIN SIMULATION LOGIC ---
        function calculateSimulation() {
            // 1. Gather Data
            let score = parseInt(baseInput.value);
            let limit = parseInt(limitInput.value);
            let balance = parseInt(balInput.value);
            const action = document.querySelector('input[name="action"]:checked').value;
            
            let newScore = score;
            let newBalance = balance;
            let newLimit = limit;
            let commentary = "";
            let historyStatus = "100%";
            let inquiryStatus = "Stable";

            // 2. Calculate Baseline Utilization
            const oldUtil = (balance / limit) * 100;

            // 3. Process Action
            if (action === 'pay') {
                const payAmount = parseInt(document.getElementById('action-amount').value) || 0;
                newBalance = Math.max(0, balance - payAmount);
                
                const newUtil = (newBalance / newLimit) * 100;
                const utilDiff = oldUtil - newUtil;
                
                // Logic: Points gained based on crossing thresholds (30%, 10%)
                if (oldUtil > 80 && newUtil < 80) newScore += 20;
                if (oldUtil > 50 && newUtil < 50) newScore += 25;
                if (oldUtil > 30 && newUtil < 30) newScore += 30;
                if (oldUtil > 10 && newUtil < 10) newScore += 15;
                
                // Base gain for just paying
                if(payAmount > 0) newScore += 5;

                commentary = `Excellent move. By paying down $${payAmount}, you dropped your utilization from ${Math.round(oldUtil)}% to ${Math.round(newUtil)}%. This is the fastest way to boost a score.`;
            
            } else if (action === 'spend') {
                const spendAmount = parseInt(document.getElementById('action-amount').value) || 0;
                newBalance = balance + spendAmount;
                const newUtil = (newBalance / newLimit) * 100;

                // Penalty Logic
                if (oldUtil < 10 && newUtil > 10) newScore -= 10;
                if (oldUtil < 30 && newUtil > 30) newScore -= 25;
                if (oldUtil < 50 && newUtil > 50) newScore -= 35;
                if (newUtil > 90) newScore -= 50; // Max out penalty

                commentary = `Warning: Adding $${spendAmount} pushed your utilization to ${Math.round(newUtil)}%. Banks get nervous when you use too much of your available credit.`;

            } else if (action === 'new_card') {
                const addedLimit = parseInt(document.getElementById('action-amount').value) || 0;
                newLimit = limit + addedLimit;
                const newUtil = (newBalance / newLimit) * 100;
                
                // Impact: Hard Pull Penalty (-5) vs Util Benefit (+)
                newScore -= 6; // Hard pull
                inquiryStatus = "New Inquiry (-6pts)";

                // If new limit significantly helps utilization, add points back
                if (oldUtil > 30 && newUtil < 30) newScore += 25;
                else if (oldUtil > 10 && newUtil < 10) newScore += 10;
                
                commentary = `Mixed bag. You took a small hit for the inquiry, but the new $${addedLimit} limit lowered your overall utilization to ${Math.round(newUtil)}%. Long term, this is a win.`;

            } else if (action === 'late') {
                const days = document.getElementById('action-late-type').value;
                historyStatus = "Missed Payment";
                
                if (days === "30") {
                    newScore -= (score > 700) ? 80 : 40; // Higher scores fall harder
                    commentary = "Ouch. A 30-day late payment is a major derogatory mark. You lose 'Good Standing' status immediately.";
                } else if (days === "60") {
                    newScore -= 100;
                    commentary = "Damage control needed. At 60 days, this is getting serious. Contact the lender immediately.";
                } else {
                    newScore -= 130;
                    commentary = "Catastrophic. A 90+ day late payment implies default. This will haunt your report for 7 years.";
                }
            }

            // Cap Score
            if (newScore > 850) newScore = 850;
            if (newScore < 300) newScore = 300;

            // 4. Update UI
            updateDashboard(score, newScore, newBalance, newLimit, historyStatus, inquiryStatus, commentary);
        }

        function updateDashboard(oldS, newS, newBal, newLim, hist, inq, comm) {
            // Update Score Text
            const scoreDiv = document.getElementById('result-score');
            const rateDiv = document.getElementById('result-rating');
            
            // Counter Animation
            let start = oldS;
            const end = newS;
            const duration = 1000;
            const startTime = performance.now();

            function updateCounter(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Ease out quart
                const ease = 1 - Math.pow(1 - progress, 4);
                
                const current = Math.floor(start + (end - start) * ease);
                scoreDiv.innerText = current;

                // Update Gauge Rotation
                // Map 300-850 to 0-180 degrees
                const deg = ((current - 300) / 550) * 180;
                document.getElementById('gauge-fill').style.transform = `rotate(${deg}deg)`;

                if (progress < 1) requestAnimationFrame(updateCounter);
            }
            requestAnimationFrame(updateCounter);

            // Update Text Rating
            if(newS >= 800) rateDiv.innerText = "Exceptional";
            else if(newS >= 740) rateDiv.innerText = "Very Good";
            else if(newS >= 670) rateDiv.innerText = "Good";
            else if(newS >= 580) rateDiv.innerText = "Fair";
            else rateDiv.innerText = "Poor";

            // Update Badge
            const badge = document.getElementById('points-badge');
            const diff = newS - oldS;
            if(diff > 0) {
                badge.className = "inline-flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-full font-bold text-sm transition-all";
                badge.innerHTML = `<i class="fa-solid fa-arrow-trend-up"></i> +${diff} Points`;
            } else if (diff < 0) {
                badge.className = "inline-flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-full font-bold text-sm transition-all";
                badge.innerHTML = `<i class="fa-solid fa-arrow-trend-down"></i> ${diff} Points`;
            } else {
                badge.className = "inline-flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-500 rounded-full font-bold text-sm transition-all";
                badge.innerHTML = `<i class="fa-solid fa-minus"></i> No Change`;
            }

            // Update Stats
            const finalUtil = Math.round((newBal / newLim) * 100);
            document.getElementById('res-util').innerText = finalUtil + "%";
            document.getElementById('res-history').innerText = hist;
            if(hist !== "100%") document.getElementById('res-history').className = "text-2xl font-black text-red-600";
            else document.getElementById('res-history').className = "text-2xl font-black text-green-600";
            
            document.getElementById('res-inquiries').innerText = inq;

            // Update Analysis
            document.getElementById('res-analysis').innerText = comm;
        }
    </script>
</body>
</html>
